# ---------------------------
# Bump version, create tag, push
# ---------------------------

# قراءة النسخة الحالية من الملف
$versionFile = "VERSION.txt"
$version = Get-Content $versionFile

# تقسيم النسخة إلى أجزاء
$parts = $version.Split('.')

# زيادة الرقم الثالث (patch)
$parts[2] = ([int]$parts[2] + 1).ToString()

# إنشاء النسخة الجديدة
$newVersion = "$($parts[0]).$($parts[1]).$($parts[2])"

# تحديث الملف
$newVersion | Set-Content $versionFile

# إضافة الملف والتزام التغييرات
git add $versionFile
git commit -m "Bump version to $newVersion"

# حذف أي تاغ خاطئ بالاسم القديم (إذا موجود)
$existingTag = "v$newVersion"
git tag -d $existingTag 2>$null
git push --delete origin $existingTag 2>$null

# إنشاء التاغ الجديد ورفعه
git tag -a $existingTag -m "Release $newVersion"
git push origin $existingTag

Write-Host "Version bumped to $newVersion and pushed with tag $existingTag ✅"
